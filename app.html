<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>H∆∞·ªõng d·∫´n ch·∫©n ƒëo√°n h·ªôi ch·ª©ng YHCT</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1730;
      --text:#e8ecff;
      --muted:#b6c0ffb3;
      --line:#26335f;
      --accent:#7aa2ff;
      --accent2:#8bf0c1;
      --danger:#ff6b8a;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 10%, rgba(122,162,255,.18), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(139,240,193,.10), transparent 55%),
                  radial-gradient(900px 600px at 50% 100%, rgba(255,107,138,.08), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
      padding: 28px 16px 48px;
    }

    .wrap{max-width:1080px;margin:0 auto;}
    header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .title{
      display:flex;flex-direction:column;gap:6px;
    }
    h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.4;
      max-width: 72ch;
    }

    .tabs{
      display:flex;
      gap:10px;
      background: rgba(18,26,51,.55);
      border: 1px solid rgba(38,51,95,.65);
      padding: 8px;
      border-radius: 999px;
      box-shadow: var(--shadow);
    }
    .tab-btn{
      appearance:none;
      border: 0;
      background: transparent;
      color: var(--muted);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
      cursor:pointer;
      transition: .2s ease;
      display:flex;align-items:center;gap:8px;
      user-select:none;
    }
    .tab-btn:hover{color:var(--text); background: rgba(122,162,255,.10);}
    .tab-btn[aria-selected="true"]{
      background: linear-gradient(135deg, rgba(122,162,255,.22), rgba(139,240,193,.14));
      color: var(--text);
      border: 1px solid rgba(122,162,255,.25);
    }

    .panel{
      margin-top: 16px;
      display:none;
      animation: fadeIn .18s ease-out;
    }
    .panel.active{display:block;}

    @keyframes fadeIn{from{opacity:.4; transform: translateY(4px);} to{opacity:1; transform: translateY(0);} }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 920px){
      header{flex-direction:column; align-items:flex-start}
      .tabs{width:100%}
      .grid{grid-template-columns:1fr;}
    }

    .card{
      background: linear-gradient(180deg, rgba(18,26,51,.85), rgba(15,23,48,.85));
      border: 1px solid rgba(38,51,95,.75);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .card h2{
      margin: 0 0 10px;
      font-size: 15px;
      letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }
    .badge{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      color: var(--text);
      background: rgba(122,162,255,.14);
      border: 1px solid rgba(122,162,255,.22);
    }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .form .full{grid-column: 1 / -1;}
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      background: rgba(8,12,26,.65);
      border: 1px solid rgba(38,51,95,.75);
      color: var(--text);
      outline:none;
      transition:.15s ease;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(122,162,255,.6);
      box-shadow: 0 0 0 3px rgba(122,162,255,.14);
    }
    textarea{min-height: 180px; resize: vertical; line-height: 1.5;}

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(38,51,95,.85);
      background: rgba(122,162,255,.14);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      transition:.15s ease;
      display:inline-flex;align-items:center;gap:10px;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(122,162,255,.55);}
    .btn.secondary{background: rgba(182,192,255,.08);}
    .btn.danger{background: rgba(255,107,138,.12); border-color: rgba(255,107,138,.35);}
    .hint{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      margin: 6px 0 0;
    }

    .result-top{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      align-items:flex-start;
      margin-bottom: 12px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(38,51,95,.75);
      background: rgba(8,12,26,.55);
      color: var(--muted);
      font-size: 12px;
    }
    .diag{
      border-left: 3px solid rgba(139,240,193,.75);
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(139,240,193,.06);
      border: 1px solid rgba(139,240,193,.18);
      margin-top: 10px;
    }
    .diag h3{margin:0 0 6px;font-size: 14px;}
    .diag p{margin:0;color:var(--text);line-height:1.55;font-size: 13px;}
    .list{
      margin: 10px 0 0;
      padding: 0;
      list-style: none;
      display:grid;
      gap: 10px;
    }
    .item{
      border: 1px solid rgba(38,51,95,.75);
      background: rgba(8,12,26,.55);
      border-radius: 14px;
      padding: 12px;
    }
    .item .k{
      font-weight: 800;
      font-size: 13px;
      margin:0 0 6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .score{
      font-size: 12px;
      color: var(--text);
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(122,162,255,.16);
      border: 1px solid rgba(122,162,255,.28);
      white-space: nowrap;
    }
    .item .v{
      margin:0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.45;
    }
    .warn{
      border-left: 3px solid rgba(255,107,138,.75);
      background: rgba(255,107,138,.06);
      border: 1px solid rgba(255,107,138,.18);
      padding: 10px 12px;
      border-radius: 14px;
      margin-top: 12px;
    }
    .warn b{color: var(--text);}
    footer{
      margin-top: 16px;
      color: rgba(182,192,255,.65);
      font-size: 12px;
      line-height:1.45;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>H∆∞·ªõng d·∫´n ch·∫©n ƒëo√°n h·ªôi ch·ª©ng b·ªánh Y h·ªçc c·ªï truy·ªÅn</h1>
      <p class="subtitle">
        Tab 1: nh·∫≠p th√¥ng tin + tri·ªáu ch·ª©ng. Tab 2: xem k·∫øt qu·∫£ sau suy lu·∫≠n (demo rule-based, b·∫°n thay b·∫±ng ILP/MaxSAT/KG sau).
      </p>
    </div>

    <nav class="tabs" role="tablist" aria-label="Tabs">
      <button class="tab-btn" id="tab-input" role="tab" aria-selected="true" aria-controls="panel-input">
        üìù Nh·∫≠p li·ªáu
      </button>
      <button class="tab-btn" id="tab-output" role="tab" aria-selected="false" aria-controls="panel-output">
        üß† Ch·∫©n ƒëo√°n
      </button>
    </nav>
  </header>

  <!-- TAB 1 -->
  <section class="panel active" id="panel-input" role="tabpanel" aria-labelledby="tab-input">
    <div class="grid">
      <!-- KHUNG 1 -->
      <div class="card">
        <h2>Khung 1: Th√¥ng tin ng∆∞·ªùi b·ªánh <span class="badge">B·∫Øt bu·ªôc t·ªëi thi·ªÉu: h·ªç t√™n + tu·ªïi + gi·ªõi</span></h2>

        <div class="form">
          <div class="full">
            <label for="name">H·ªç t√™n</label>
            <input id="name" type="text" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" />
          </div>

          <div>
            <label for="age">Tu·ªïi</label>
            <input id="age" type="number" min="0" max="130" placeholder="V√≠ d·ª•: 45" />
          </div>

          <div>
            <label for="sex">Gi·ªõi</label>
            <select id="sex">
              <option value="">-- Ch·ªçn --</option>
              <option value="male">Nam</option>
              <option value="female">N·ªØ</option>
              <option value="other">Kh√°c</option>
            </select>
          </div>

          <div>
            <label for="weight">C√¢n n·∫∑ng (kg)</label>
            <input id="weight" type="number" min="0" step="0.1" placeholder="V√≠ d·ª•: 60" />
          </div>

          <div>
            <label for="height">Chi·ªÅu cao (cm)</label>
            <input id="height" type="number" min="0" step="0.1" placeholder="V√≠ d·ª•: 165" />
          </div>

          <div class="full">
            <p class="hint">G·ª£i √Ω: h·ªá th·ªëng c√≥ th·ªÉ t·ª± t√≠nh BMI ƒë·ªÉ h·ªó tr·ª£ ƒë√°nh gi√° th·ªÉ tr·∫°ng (tu·ª≥ b·∫°n m·ªü r·ªông).</p>
          </div>
        </div>

        <div class="row">
          <button class="btn secondary" id="btnFillDemo" type="button">‚ö° ƒêi·ªÅn d·ªØ li·ªáu m·∫´u</button>
          <button class="btn danger" id="btnClear" type="button">üßπ Xo√° d·ªØ li·ªáu</button>
        </div>
      </div>

      <!-- KHUNG 2 -->
      <div class="card">
        <h2>Khung 2: Tri·ªáu ch·ª©ng (v·∫•n ch·∫©n) <span class="badge">Nh·∫≠p d·∫°ng g·∫°ch ƒë·∫ßu d√≤ng / c√°ch nhau b·∫±ng d·∫•u ph·∫©y</span></h2>

        <label for="symptoms">Tri·ªáu ch·ª©ng</label>
        <textarea id="symptoms" placeholder="V√≠ d·ª•:
- s·ª£ l·∫°nh
- tay ch√¢n l·∫°nh
- m·ªát m·ªèi
- ti·ªÉu trong nhi·ªÅu
- l∆∞·ª°i nh·∫°t, r√™u tr·∫Øng..."></textarea>

        <div class="row">
          <button class="btn" id="btnInfer" type="button">üß† Suy lu·∫≠n &amp; xem ch·∫©n ƒëo√°n</button>
          <span class="pill" id="bmiPill">BMI: <span class="mono" id="bmiValue">‚Äî</span></span>
          <span class="pill">Tr·∫°ng th√°i: <span class="mono" id="statusValue">Ch∆∞a suy lu·∫≠n</span></span>
        </div>

        <p class="hint">
          Demo hi·ªán d√πng <span class="mono">rule-based scoring</span> (t·ª´ kho√° ‚Üí c·ªông ƒëi·ªÉm). Khi b·∫°n c√≥ KG/constraint/ILP, ch·ªâ c·∫ßn thay h√†m suy lu·∫≠n.
        </p>
      </div>
    </div>

    <footer>
      <b>L∆∞u √Ω:</b> ƒê√¢y l√† giao di·ªán + logic demo ph·ª•c v·ª• nghi√™n c·ª©u/hu·∫•n luy·ªán. Kh√¥ng thay th·∫ø ch·∫©n ƒëo√°n y khoa.
    </footer>
  </section>

  <!-- TAB 2 -->
  <section class="panel" id="panel-output" role="tabpanel" aria-labelledby="tab-output">
    <div class="card">
      <div class="result-top">
        <div>
          <h2 style="margin:0;">K·∫øt qu·∫£ ch·∫©n ƒëo√°n (sau suy lu·∫≠n)</h2>
          <p class="hint" style="margin-top:6px;">
            Hi·ªÉn th·ªã top h·ªôi ch·ª©ng + gi·∫£i th√≠ch l√Ω do + c√¢u h·ªèi g·ª£i √Ω b·ªï sung tri·ªáu ch·ª©ng (n·∫øu thi·∫øu).
          </p>
        </div>
        <div class="pill">
          H·ªì s∆°: <span class="mono" id="profileSummary">‚Äî</span>
        </div>
      </div>

      <div class="diag" id="bestDiag">
        <h3>Ch∆∞a c√≥ k·∫øt qu·∫£</h3>
        <p>H√£y nh·∫≠p d·ªØ li·ªáu ·ªü Tab 1 v√† b·∫•m ‚ÄúSuy lu·∫≠n‚Äù.</p>
      </div>

      <ul class="list" id="rankList"></ul>

      <div class="warn">
        <b>C·∫£nh b√°o an to√†n:</b> N·∫øu c√≥ d·∫•u hi·ªáu c·∫•p c·ª©u (ƒëau ng·ª±c, kh√≥ th·ªü, y·∫øu li·ªát, l√∫ l·∫´n, s·ªët cao k√©o d√†i...), c·∫ßn kh√°m/c·∫•p c·ª©u ngay.
      </div>

      <footer>
        G·ª£i √Ω n√¢ng c·∫•p logic: thay <span class="mono">inferSyndromes()</span> b·∫±ng engine ILP/MaxSAT ho·∫∑c truy v·∫•n KG (symptom‚Üísyndrome) + constraint (incompatibility).
      </footer>
    </div>
  </section>
</div>

<script>
  // ---------- Tabs ----------
  const tabInput = document.getElementById('tab-input');
  const tabOutput = document.getElementById('tab-output');
  const panelInput = document.getElementById('panel-input');
  const panelOutput = document.getElementById('panel-output');

  function setTab(which){
    const isInput = which === 'input';
    tabInput.setAttribute('aria-selected', String(isInput));
    tabOutput.setAttribute('aria-selected', String(!isInput));
    panelInput.classList.toggle('active', isInput);
    panelOutput.classList.toggle('active', !isInput);
  }

  tabInput.addEventListener('click', () => setTab('input'));
  tabOutput.addEventListener('click', () => setTab('output'));

  // ---------- Form fields ----------
  const elName = document.getElementById('name');
  const elAge = document.getElementById('age');
  const elSex = document.getElementById('sex');
  const elWeight = document.getElementById('weight');
  const elHeight = document.getElementById('height');
  const elSymptoms = document.getElementById('symptoms');

  const bmiValue = document.getElementById('bmiValue');
  const statusValue = document.getElementById('statusValue');

  const profileSummary = document.getElementById('profileSummary');
  const bestDiag = document.getElementById('bestDiag');
  const rankList = document.getElementById('rankList');

  function computeBMI(){
    const w = parseFloat(elWeight.value);
    const hCm = parseFloat(elHeight.value);
    if(!isFinite(w) || !isFinite(hCm) || w<=0 || hCm<=0) return null;
    const h = hCm / 100;
    const bmi = w / (h*h);
    return Math.round(bmi * 10) / 10;
  }

  function updateBMIPill(){
    const bmi = computeBMI();
    bmiValue.textContent = (bmi === null) ? '‚Äî' : String(bmi);
  }

  elWeight.addEventListener('input', updateBMIPill);
  elHeight.addEventListener('input', updateBMIPill);

  // ---------- Helpers ----------
  function normalizeSymptomsText(text){
    return text
      .toLowerCase()
      .replace(/[‚Ä¢\-\u2022]/g, ' ')
      .replace(/\s+/g, ' ')
      .trim();
  }

  function tokenizeSymptoms(text){
    const t = normalizeSymptomsText(text);
    if(!t) return [];
    // Split by newline or comma or semicolon
    const raw = t.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean);
    // Also include whole normalized text for contains-match
    return { list: raw, full: t };
  }

  // ---------- Demo knowledge base ----------
  // B·∫°n thay ph·∫ßn n√†y b·∫±ng d·ªØ li·ªáu th·∫≠t (KG + constraint + weights).
  const KNOWLEDGE = [
    {
      code: "D∆Ø∆†NG H∆Ø",
      label: "Th·∫≠n d∆∞∆°ng h∆∞ / D∆∞∆°ng h∆∞ (g·ª£i √Ω)",
      keywords: [
        "s·ª£ l·∫°nh","l·∫°nh","tay ch√¢n l·∫°nh","m·ªát m·ªèi","ti·ªÉu trong","ti·ªÉu nhi·ªÅu",
        "ph√π","ƒëau l∆∞ng","li·ªát d∆∞∆°ng","gi·∫£m ham mu·ªën","l∆∞·ª°i nh·∫°t","r√™u tr·∫Øng"
      ],
      missingQuestions: [
        "B·∫°n c√≥ s·ª£ l·∫°nh r√µ, th√≠ch ·∫•m, ∆∞a ch∆∞·ªùm ·∫•m kh√¥ng?",
        "Ti·ªÉu trong nhi·ªÅu/l√¢u? c√≥ ph√π nh·∫π bu·ªïi s√°ng kh√¥ng?",
        "L∆∞ng g·ªëi m·ªèi l·∫°nh, sinh l·ª±c gi·∫£m?"
      ]
    },
    {
      code: "√ÇM H∆Ø",
      label: "Th·∫≠n √¢m h∆∞ / √Çm h∆∞ (g·ª£i √Ω)",
      keywords: [
        "n√≥ng trong","tri·ªÅu nhi·ªát","ra m·ªì h√¥i tr·ªôm","kh√¥ mi·ªáng","kh√°t",
        "m·∫•t ng·ªß","b·ª©t r·ª©t","ng≈© t√¢m phi·ªÅn nhi·ªát","l∆∞·ª°i ƒë·ªè","√≠t r√™u","t√°o b√≥n"
      ],
      missingQuestions: [
        "C√≥ n√≥ng v·ªÅ chi·ªÅu/ƒë√™m, ra m·ªì h√¥i tr·ªôm kh√¥ng?",
        "Kh√¥ h·ªçng, kh√°t, l∆∞·ª°i ƒë·ªè √≠t r√™u?",
        "M·∫•t ng·ªß, b·ª©t r·ª©t, t√°o b√≥n?"
      ]
    },
    {
      code: "T·ª≤ KH√ç H∆Ø",
      label: "T·ª≥ kh√≠ h∆∞ (g·ª£i √Ω)",
      keywords: [
        "ƒÉn k√©m","ƒë·∫ßy b·ª•ng","ch∆∞·ªõng b·ª•ng","m·ªát sau ƒÉn","ƒë·∫°i ti·ªán l·ªèng",
        "ti√™u ch·∫£y","s·ª£ m·ª°","h∆°i th·ªü ng·∫Øn","m·∫∑t v√†ng","l∆∞·ª°i nh·∫°t","r√™u tr·∫Øng"
      ],
      missingQuestions: [
        "ƒÇn k√©m, ƒë·∫ßy b·ª•ng, m·ªát sau ƒÉn?",
        "ƒê·∫°i ti·ªán l·ªèng/ti√™u ch·∫£y k√©o d√†i?",
        "L∆∞·ª°i nh·∫°t r√™u tr·∫Øng, s·∫Øc m·∫∑t v√†ng?"
      ]
    },
    {
      code: "CAN KH√ç U·∫§T",
      label: "Can kh√≠ u·∫•t (g·ª£i √Ω)",
      keywords: [
        "cƒÉng t·ª©c ng·ª±c","s∆∞·ªùn ƒëau t·ª©c","th·ªü d√†i","d·ªÖ c√°u","stress",
        "u·∫•t ·ª©c","ƒë·∫ßy t·ª©c","kinh nguy·ªát kh√¥ng ƒë·ªÅu","ƒëau ƒë·∫ßu do cƒÉng th·∫≥ng"
      ],
      missingQuestions: [
        "C√≥ hay th·ªü d√†i, t·ª©c ng·ª±c/s∆∞·ªùn, n·∫∑ng khi stress?",
        "D·ªÖ c√°u g·∫Øt, u·∫•t ·ª©c, ng·ªß k√©m?",
        "N·ªØ: kinh nguy·ªát th·∫•t th∆∞·ªùng/ƒëau b·ª•ng kinh?"
      ]
    }
  ];

  // Simple constraint examples (demo):
  // - If both "s·ª£ l·∫°nh" and "n√≥ng trong" present, warn about mixed/counter-signs.
  const CONTRA_SIGNS = [
    { a: "s·ª£ l·∫°nh", b: "n√≥ng trong", message: "C√≥ ƒë·ªìng th·ªùi 's·ª£ l·∫°nh' v√† 'n√≥ng trong' ‚Üí g·ª£i √Ω th·ªÉ h·ªón h·ª£p/ki√™m ch·ª©ng; c·∫ßn h·ªèi th√™m d·∫•u hi·ªáu h√†n-nhi·ªát." }
  ];

  function inferSyndromes(symptomsText){
    const tok = tokenizeSymptoms(symptomsText);
    const list = tok.list;
    const full = tok.full;

    const results = KNOWLEDGE.map(s => {
      let score = 0;
      const hits = [];
      for(const kw of s.keywords){
        // Match either in full text or by item list contains kw
        const hit = full.includes(kw) || list.some(x => x.includes(kw));
        if(hit){
          score += 1;
          hits.push(kw);
        }
      }
      // Slight boost if many hits
      if(score >= 6) score += 1;
      if(score >= 9) score += 1;

      return { ...s, score, hits };
    })
    .sort((x,y) => y.score - x.score);

    // Contra-sign checks (demo)
    const contra = [];
    for(const c of CONTRA_SIGNS){
      if(full.includes(c.a) && full.includes(c.b)) contra.push(c.message);
    }

    return { results, contra };
  }

  function formatProfile(){
    const name = (elName.value || "").trim();
    const age = (elAge.value || "").trim();
    const sex = elSex.value;
    const sexLabel = sex === "male" ? "Nam" : sex === "female" ? "N·ªØ" : sex === "other" ? "Kh√°c" : "‚Äî";
    const bmi = computeBMI();
    const bmiText = (bmi === null) ? "BMI ‚Äî" : `BMI ${bmi}`;
    const nameText = name ? name : "‚Äî";
    const ageText = age ? `${age}t` : "‚Äî";
    return `${nameText} ¬∑ ${ageText} ¬∑ ${sexLabel} ¬∑ ${bmiText}`;
  }

  function renderOutput(infer){
    const { results, contra } = infer;

    profileSummary.textContent = formatProfile();

    // Best diagnosis block
    const best = results[0];
    const hasAny = best && best.score > 0;

    if(!hasAny){
      bestDiag.innerHTML = `
        <h3>Ch∆∞a ƒë·ªß d·ªØ li·ªáu ƒë·ªÉ suy lu·∫≠n</h3>
        <p>H√£y nh·∫≠p tri·ªáu ch·ª©ng c·ª• th·ªÉ h∆°n (∆∞u ti√™n: h√†n/nhi·ªát, m·ªì h√¥i, ƒë·∫°i-ti·ªÉu ti·ªán, kh√°t, ng·ªß, l∆∞·ª°i...).</p>
      `;
    }else{
      const hitText = best.hits.slice(0, 10).map(x => `<span class="mono">${escapeHtml(x)}</span>`).join(", ");
      const ask = best.missingQuestions.map(q => `<li>${escapeHtml(q)}</li>`).join("");
      bestDiag.innerHTML = `
        <h3>H·ªôi ch·ª©ng g·ª£i √Ω: ${escapeHtml(best.label)}</h3>
        <p><b>ƒêi·ªÉm ph√π h·ª£p:</b> ${best.score} ¬∑ <b>Tri·ªáu ch·ª©ng kh·ªõp:</b> ${hitText || "‚Äî"}</p>
        <p style="margin-top:8px;color:var(--muted);font-size:12px;line-height:1.45;">
          <b>C√¢u h·ªèi b·ªï sung</b> (ƒë·ªÉ tƒÉng ch·∫Øc ch·∫Øn bi·ªán ch·ª©ng):
        </p>
        <ul style="margin:8px 0 0; padding-left: 18px; color: var(--text); font-size: 13px; line-height:1.5;">
          ${ask}
        </ul>
        ${contra.length ? `
          <div class="warn" style="margin-top:12px;">
            <b>Ki·ªÉm tra ki√™m ch·ª©ng/ƒë·ªëi ch·ª©ng:</b>
            <div style="margin-top:6px;color:var(--muted);font-size:12px;line-height:1.45;">
              ${contra.map(m => `‚Ä¢ ${escapeHtml(m)}`).join("<br/>")}
            </div>
          </div>` : ""
        }
      `;
    }

    // Ranking list
    rankList.innerHTML = "";
    const topN = results.slice(0, 4);
    for(const r of topN){
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <p class="k">
          <span>${escapeHtml(r.label)}</span>
          <span class="score">score: ${r.score}</span>
        </p>
        <p class="v">
          Kh·ªõp: ${r.hits.length ? r.hits.slice(0, 12).map(x => `<span class="mono">${escapeHtml(x)}</span>`).join(", ") : "‚Äî"}
        </p>
      `;
      rankList.appendChild(li);
    }
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ---------- Buttons ----------
  const btnInfer = document.getElementById('btnInfer');
  const btnClear = document.getElementById('btnClear');
  const btnFillDemo = document.getElementById('btnFillDemo');

  btnInfer.addEventListener('click', () => {
    const name = (elName.value || "").trim();
    const age = (elAge.value || "").trim();
    const sex = elSex.value;

    if(!name || !age || !sex){
      statusValue.textContent = "Thi·∫øu h·ªç t√™n/tu·ªïi/gi·ªõi";
      alert("B·∫°n vui l√≤ng nh·∫≠p t·ªëi thi·ªÉu: H·ªç t√™n + Tu·ªïi + Gi·ªõi.");
      return;
    }

    updateBMIPill();

    const sym = (elSymptoms.value || "").trim();
    if(!sym){
      statusValue.textContent = "Thi·∫øu tri·ªáu ch·ª©ng";
      alert("B·∫°n vui l√≤ng nh·∫≠p tri·ªáu ch·ª©ng (Khung 2).");
      return;
    }

    const infer = inferSyndromes(sym);
    renderOutput(infer);
    statusValue.textContent = "ƒê√£ suy lu·∫≠n";
    setTab('output');
  });

  btnClear.addEventListener('click', () => {
    elName.value = "";
    elAge.value = "";
    elSex.value = "";
    elWeight.value = "";
    elHeight.value = "";
    elSymptoms.value = "";
    updateBMIPill();
    statusValue.textContent = "Ch∆∞a suy lu·∫≠n";
    profileSummary.textContent = "‚Äî";
    bestDiag.innerHTML = `<h3>Ch∆∞a c√≥ k·∫øt qu·∫£</h3><p>H√£y nh·∫≠p d·ªØ li·ªáu ·ªü Tab 1 v√† b·∫•m ‚ÄúSuy lu·∫≠n‚Äù.</p>`;
    rankList.innerHTML = "";
    setTab('input');
  });

  btnFillDemo.addEventListener('click', () => {
    elName.value = "Nguy·ªÖn VƒÉn A";
    elAge.value = "52";
    elSex.value = "male";
    elWeight.value = "68";
    elHeight.value = "170";
    elSymptoms.value = `- s·ª£ l·∫°nh
- tay ch√¢n l·∫°nh
- m·ªát m·ªèi
- ti·ªÉu trong nhi·ªÅu
- ƒëau l∆∞ng m·ªèi g·ªëi
- l∆∞·ª°i nh·∫°t, r√™u tr·∫Øng`;
    updateBMIPill();
    statusValue.textContent = "ƒê√£ ƒëi·ªÅn d·ªØ li·ªáu m·∫´u";
  });

  // Init
  updateBMIPill();
</script>
</body>
</html>
